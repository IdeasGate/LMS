@using Sirkadirov.Overtest.WebApplication.ViewComponents.Shared
@using Sirkadirov.Overtest.WebApplication.Extensions.HtmlHelpers
@using Microsoft.AspNetCore.Html
@using System.Linq
@using System.Security.Claims
@using Microsoft.EntityFrameworkCore
@using Sirkadirov.Overtest.Libraries.Shared.Database.Operators

@model Sirkadirov.Overtest.Libraries.Shared.Database.Storage.Identity.User

@{
  var currentUserId = new Guid(UserManager.GetUserId(Context.User));
}

<nav class="navbar navbar-global navbar-expand-lg bg-white fixed-top no-selection-allowed">
  <div class="container">

    <a class="navbar-brand font-weight-bold" asp-controller="Welcome" asp-action="Home">
      <img src="~/assets/svg/logos/sirkadirov-logo.svg" width="30" height="30" class="d-inline-block align-top" loading="lazy" /> <span>Overtest</span>
    </a>

    <a class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#@nameof(UserNavbarViewComponent)">
      <span class="fas fa-bars text-dark"></span>
    </a>

    <div class="collapse navbar-collapse" id="@nameof(UserNavbarViewComponent)">

      <ul class="navbar-nav mr-auto">

        @{
          Func<dynamic, IHtmlContent> CreateAreaLink(string area, string controller, string action, string icon, string linkText) =>
            @<li class="nav-item">
              <a class="nav-link @Html.EnsureRequestedClassAdded(Html.IsSameAreaName(area))" asp-area="@area" asp-controller="@controller" asp-action="@action"><i class="@icon"></i> @linkText</a>
            </li>;
        }

        @if (await DatabaseContext.UserPermissionsOperator.VerifyUserTypeSetAsync(currentUserId, OvertestUserPermissionsOperator.UserTypeSet.ApprovedUser))
        {

          @CreateAreaLink("", "Welcome", "Home", "fas fa-home", Localizer["Головна"].Value)(null)

          @CreateAreaLink("TasksArchive", "ProgrammingTasksArchive", "List", "fas fa-folder", Localizer["Архів завдань"].Value)(null)

          @CreateAreaLink("Social", "Users", "List", "fas fa-users", Localizer["Користувачі"].Value)(null)

        }

        @if (Model.Type == UserType.Student)
        {
          @* Competitions *@
          @*CreateAreaLink("Competition", "Competitions", "Join", "fas fa-snowboarding", Localizer["Змагання"].Value)(null)*@
          <li class="nav-item">
            <a class="nav-link disabled" href="#"><i class="fas fa-snowboarding"></i> @Localizer["Змагання"] <span class="badge badge-warning">SOON</span></a>
          </li>
        }

        @if (await DatabaseContext.UserPermissionsOperator.VerifyUserTypeSetAsync(currentUserId, OvertestUserPermissionsOperator.UserTypeSet.Curator))
        {

          @* Administration *@
          <li class="nav-item">
            <a class="nav-link disabled" href="#"><i class="fas fa-user-shield"></i> @Localizer["Адміністрування"] <span class="badge badge-warning">SOON</span></a>
          </li>

        }

      </ul>

      @* User menu *@
      <ul class="navbar-nav">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-dark" href="#" data-toggle="dropdown">
            <i class="fas fa-user-circle"></i> <span class="d-md-none d-lg-none d-xl-none">@Localizer["Користувач"]</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right">

            @{
              var userFullName = await DatabaseContext.Users
                .Where(u => u.Id.ToString() == User.FindFirstValue(ClaimTypes.NameIdentifier))
                .Select(u => u.FullName)
                .FirstAsync();
            }

            <a class="dropdown-item pt-3 pb-3" asp-area="Social" asp-controller="Users" asp-action="Profile">
              <p class="m-0 lead text-dark text-center">
                <i class="fas fa-user-circle"></i> @userFullName
              </p>
            </a>
            
            <div class="dropdown-divider"></div>
            
            <a class="dropdown-item" asp-area="Social" asp-controller="Users" asp-action="Profile">
              <i class="fas fa-id-card"></i> @Localizer["Мій профіль"]
            </a>

            <div class="dropdown-divider"></div>

            <a class="dropdown-item" asp-controller="Auth" asp-action="LogOut">
              <i class="fas fa-sign-out-alt"></i> @Localizer["Вийти з системи"]
            </a>

          </div>
        </li>
      </ul>

    </div>

  </div>
</nav>

@* Hidden spacer (for fixed navbar) *@
<div style="margin-top: 56px;"></div>

@* Scroll navigation bar *@

<nav class="navbar navbar-global-scroller navbar-scroller navbar-expand-lg navbar-light bg-white no-selection-allowed">
  <div class="container">
    <ul class="navbar-nav">
      
      <partial name="~/Views/Shared/ViewComponents/Shared/UserNavbar/ScrollNavigationItems.cshtml"/>
      
    </ul>
  </div>
</nav>

@* Border line (navigation scroller independent) *@
<div class="m-0 border-bottom"></div>